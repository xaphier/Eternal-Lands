<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE boost_serialization>
<boost_serialization signature="serialization::archive" version="9">
<shader_source class_id="0" tracking_level="0" version="1">
	<px class_id="1" tracking_level="1" version="0" object_id="_0">
		<types class_id="2" tracking_level="0" version="0">
			<count>1</count>
			<item_version>0</item_version>
			<item>10</item>
		</types>
		<name class_id="3" tracking_level="0" version="0">
			<str>esm</str>
		</name>
		<datas class_id="4" tracking_level="0" version="0">
			<count>1</count>
			<item_version>0</item_version>
			<item class_id="5" tracking_level="0" version="0">
				<parameters class_id="6" tracking_level="0" version="0">
					<count>6</count>
					<item_version>0</item_version>
					<item class_id="7" tracking_level="0" version="0">
						<source>
							<str>esm_shadow_mapping</str>
						</source>
						<name>
							<str>shadow</str>
						</name>
						<type>12</type>
						<qualifier>1</qualifier>
						<size>0</size>
						<scale>1</scale>
					</item>
					<item>
						<source>
							<str>esm_shadow_mapping</str>
						</source>
						<name>
							<str>shadow_sampler</str>
						</name>
						<type>34</type>
						<qualifier>0</qualifier>
						<size>0</size>
						<scale>1</scale>
					</item>
					<item>
						<source>
							<str>esm_shadow_mapping</str>
						</source>
						<name>
							<str>shadow_uv_ddx_ddy</str>
						</name>
						<type>15</type>
						<qualifier>0</qualifier>
						<size>0</size>
						<scale>1</scale>
					</item>
					<item>
						<source>
							<str>esm_shadow_mapping</str>
						</source>
						<name>
							<str>shadow_uvs</str>
						</name>
						<type>15</type>
						<qualifier>0</qualifier>
						<size>3</size>
						<scale>1</scale>
					</item>
					<item>
						<source>
							<str>esm_shadow_mapping</str>
						</source>
						<name>
							<str>shadow_view_distance</str>
						</name>
						<type>12</type>
						<qualifier>0</qualifier>
						<size>0</size>
						<scale>1</scale>
					</item>
					<item>
						<source>
							<str>esm_shadow_mapping</str>
						</source>
						<name>
							<str>world_position</str>
						</name>
						<type>14</type>
						<qualifier>0</qualifier>
						<size>0</size>
						<scale>1</scale>
					</item>
				</parameters>
				<version>1</version>
				<source>
					<str>vec3 uv;
float occluder, light_distance;
int i;

const float light_shadow_bias = 0.01;
const float over_darkening_factor = 5.0;

shadow = 1.0;

for (i = 0; i &lt; shadow_maps_count; ++i)
{
	uv = shadow_uvs[i].xyz / shadow_uvs[i].w;

	if (all(lessThan(abs(uv - vec3(0.5)), vec3(0.4995))))
	{
		occluder = textureGrad(shadow_sampler, vec3(uv.xy, i), shadow_uv_ddx_ddy.xy, shadow_uv_ddx_ddy.zw).r;

		light_distance = shadow_view_distance + light_shadow_bias;

		shadow = exp(over_darkening_factor * (log(occluder) - light_distance));
		shadow = clamp(shadow, 0.0, 1.0);
		break;
	}
}
</str>
				</source>
			</item>
		</datas>
	</px>
</shader_source>
</boost_serialization>

